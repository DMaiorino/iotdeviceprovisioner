#!python
from __future__ import print_function
import argparse
import os
import platform
import boto3
import conduit_credential_provider
from n19_seed_of_life_bootstrap import configure_account_region

default_device_name = platform.node().replace(".", "_")
default_seedoflife_dir = "/seedoflife"
default_seedoflife_account = "716018085429"
default_region = "us-east-1"
default_stage = "beta"

parser = argparse.ArgumentParser()
parser.add_argument("--account",
                    help="The AWS Seed Of Life Device Account",
                    default=default_seedoflife_account)
parser.add_argument("--region",
                    help="Region in which to provision device",
                    default=default_region)
parser.add_argument("--no-use-conduit",
                    help="Do not use conduit for obtaining credentials, assume we can get them from HOSM, environment, or ~/.aws/credentials",
                    action="store_true",
                    default=False)

args = parser.parse_args()

if args.no_use_conduit and args.account:
    raise ValueError("Only specify account id if using Conduit")

if args.no_use_conduit:
    boto3_session = boto3.session.Session(region_name=args.region)
else:
    boto3_session = conduit_credential_provider.get_boto3_session(args.account,
                                                                  args.region)

configure_account_region(boto3_session=boto3_session)
